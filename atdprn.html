<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>atdprn</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/semantic-ui/2.1.8/semantic.min.css">
  <link rel="stylesheet" href="http://daigofuji.github.io/bbclub-font/css/bbclub-font.css">
  <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
  <!-- <script src="http://underscorejs.org/underscore-min.js"></script>
  <script src="http://backbonejs.org/backbone-min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/semantic-ui/2.1.8/semantic.min.js"></script> -->
  <script src="http://stevenlevithan.com/assets/misc/date.format.js"></script>
</head>
<body>
<div class="ui vertical center aligned container">
  <h1 class="ui center aligned header">Are the Dodgers playing right now?</h1>
  <div id="playing-now">
    <p>good question, checking...</p>
    <div class="ui active centered small inline loader"></div>
  </div>

  <script id="playing-now-template-no" type="x-tmpl-mustache">
    <h2 id="playing-now-status">{{ playing_now }}</h2>
    <div class="content"><i>{{ no_but }}</i></div>
  </script>

  <script id="playing-now-template-yes" type="x-tmpl-mustache">
    <h2 id="playing-now-status">{{ playing_now }}</h2>
    <div class="ui stackable two column very relaxed grid container" style="position:relative;">
      <div class="column">
        <div class="ui segment">
          <h1><i class="bb-{{ away_name_abbrev }} bb-5x"></i></h1>
          <div class="bb-3x">{{ away_score }}</div>
        </div>
      </div>
      <div class="ui vertical divider">@</div>
      <div class="column">
        <div class="ui segment">
          <h1><i class="bb-{{ home_name_abbrev }} bb-5x"></i></h1>
          <div class="bb-3x">{{ home_score }}</div>
        </div>
      </div>
    </div>
    <h2><i class="{{ inning_state }}"></i> {{ inning }}</h2>
    <div class="ui divider"></div>
  </script>

  <script id="playing-now-template-final" type="x-tmpl-mustache">
    <h2 id="playing-now-status">{{ playing_now }}</h2>
    <div class="content"><i>{{ no_but }}</i></div>
    <div class="ui hidden divider"></div>
    <div class="ui stackable two column very relaxed grid container" style="position:relative;">
      <div class="column">
        <div class="ui segment">
          <h1><i class="bb-{{ away_name_abbrev }} bb-5x"></i></h1>
          <div class="bb-3x">{{ away_score }}</div>
        </div>
      </div>
      <div class="ui vertical divider">@</div>
      <div class="column">
        <div class="ui segment">
          <h1><i class="bb-{{ home_name_abbrev }} bb-5x"></i></h1>
          <div class="bb-3x">{{ home_score }}</div>
        </div>
      </div>
    </div>
    <h2>Final {{ extra }}</h2>
    <div class="ui divider"></div>
  </script>

</div>

<div class="ui hidden divider"></div>
<div class="ui vertical center aligned container">
  <h2 class="ui center aligned header">Today's Games:</h2>
  <div id="other-games" class="ui four doubling cards">
    Loading games...
  </div>
</div>

<div class="ui hidden divider"></div>
<div class="ui vertical footer segment">
  <div class="ui center aligned container">
    <div class="ui form">
      <div class="inline field">
        <!-- Target -->
        <label><i class="share alternate icon"></i></label>
        <input id="share-url" value="http://bit.ly/mlb-thingy-atdprn">
        <!-- Trigger -->
        <!-- <button class="btn" data-clipboard-target="#foo"> -->
        <i class="btn-share-url-copy clipboard icon" data-clipboard-target="#share-url"></i>
        <!-- </button> -->
      </div>
    </div>
  </div>
</div>

<script id="other-games-template" type="x-tmpl-mustache">
  {{ #game }}
    <div class="{{ color }} card">
      <div class="content">
        <div class="content">
          <div class="ui two column grid">
            <div class="column">
              <div><i class="bb-{{ away_name_abbrev }} bb-3x"></i></div>
              <div>{{ away_score }}</div>
            </div>
            <div class="column">
              <div><i class="bb-{{ home_name_abbrev }} bb-3x"></i></div>
              <div>{{ home_score }}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="content"><i class="{{ inning_state }}"></i> {{ inning }}</div>
      <div class="extra content">
        <div>{{ status }}</div>
        <div>{{ event_time }} (EST)</div>
      </div>
    </div>
  {{ /game }}
</script>

<script type="text/javascript">
  var now = new Date();
  var year = now.getFullYear();
  var month = now.format("mm");
  var day = now.format("dd");
  var yesterday = parseInt(day, 10);
  yesterday--;
  
  // mustashe templates
  // game now status
  var playing_now_template_no = $('#playing-now-template-no').html();
  Mustache.parse(playing_now_template_no);
  var playing_now_template_yes = $('#playing-now-template-yes').html();
  Mustache.parse(playing_now_template_yes);
  // other games
  var other_games_template = $('#other-games-template').html();
  Mustache.parse(other_games_template);

  // get info about today's games every 30 seconds
  getGrid();
  var intervalID = window.setInterval(getGrid, 30000);
  function getGrid() {
    $.getJSON("http://gd2.mlb.com/components/game/mlb/year_"+ year +"/month_"+ month +"/day_"+ day +"/grid.json", function(grid) {
    // console.log("grid:", grid);
    // find Dodger game
    grid.data.games.game.forEach(function(game) {
      // console.log("game:", game);
      // console.log("game status:", game.status);
      if (game.away_team_name === "Dodgers" || game.home_team_name === "Dodgers") {
        // add a little Dodger blue
        game.color = "blue";
        if (game.status === "In Progress") {
          // console.log("game:", game);
          // set answer to "Yes."
          game.playing_now = "Yes.";
          // get inning state
          if (game.top_inning === "Y") {
            game.inning_state = "caret up icon";
          } else if (game.top_inning === "N") {
            game.inning_state = "caret down icon";
          }
          // render playing now template real quick
          var playing_now = Mustache.render(playing_now_template_yes, game);
          // console.log("playing_now:", playing_now);
          $('#playing-now').html(playing_now);
        } else if (game.status === "Pre-Game") {
          game.playing_now = "No, but get ready!";      
          game.no_but = "The game shall begin shortly.";
          var playing_now = Mustache.render(playing_now_template_no, game);
          $('#playing-now').html(playing_now);
        } else if (game.status === "Game Over") {
          game.playing_now = "No, but it just ended.";
          game.no_but = "Results below."
          var playing_now = Mustache.render(playing_now_template_no, game);
          $('#playing-now').html(playing_now);
        } else if (game.status === "Final") {
          game.playing_now = "No, they already played today.";
          game.no_but = "Here are the results:"
          // if free baseball
          if (game.inning > 9) {
            console.log("extra? yep");
            game.extra = '('+ game.inning +')';
            console.log("game:", game);
          } else {
            game.inning = '';
          }
          var playing_now_template_final = $('#playing-now-template-final').html();
          var playing_now = Mustache.render(playing_now_template_final, game);
          $('#playing-now').html(playing_now);
        } else {
          // console.log("game(else):", game);
          // console.log("game status:", game.status);
          // set answer to "No."
          game.playing_now = "No.";      
          // game.no_but = "But you can always... "+ stupid[stupid_random];
          game.no_but = "But you can always... "+ getStupidThing(day);
          // render playing now template real quick
          var playing_now = Mustache.render(playing_now_template_no, game);
          $('#playing-now').html(playing_now);
          // console.log("gid:", game.id);
          var gid = "gid_"+ game.id.split(/\/|-/).join('_');
          // console.log("gid:", gid);
          // get today's Dodger game details
          $.getJSON("http://gd2.mlb.com/components/game/mlb/year_"+ year +"/month_"+ month +"/day_"+ day +"/"+ gid +"/linescore.json", function(linescore) {
            // console.log("linescore:", linescore);
            $('#game-location').text(linescore.data.game.location);
            $('#game-time').text(linescore.data.game.home_time + linescore.data.game.home_ampm +" "+ linescore.data.game.home_time_zone);
            // get yesterday's result
            // $.getJSON("http://gd2.mlb.com/components/game/mlb/year_"+ year +"/month_"+ month +"/day_"+ yesterday +"/grid.json", function(grid_yesterday) {
            //   // console.log("grid_yesterday:", grid_yesterday);
            //   grid_yesterday.data.games.game.forEach(function(game_yesterday) {
            //     if (game_yesterday.away_team_name === "Dodgers" || game_yesterday.home_team_name === "Dodgers") {
            //       var gid_yesterday = "gid_"+ game_yesterday.id.split(/\/|-/).join('_');
            //       // console.log("gid_yesterday:", gid_yesterday);
            //       $.getJSON("http://gd2.mlb.com/components/game/mlb/year_"+ year +"/month_"+ month +"/day_"+ yesterday +"/"+ gid_yesterday +"/linescore.json", function(yesterday_linescore) {
            //         // console.log("yesterday_linescore:", yesterday_linescore);
            //         $('#yesterday-score-away').text(yesterday_linescore.data.game.away_team_runs);
            //         $('#yesterday-score-home').text(yesterday_linescore.data.game.home_team_runs);
            //         $('#yesterday-game-opponent').text(yesterday_linescore.data.game.away_team_city +", "+ yesterday_linescore.data.game.away_team_name);
            //       });
            //     }
            //   });
            // });
          });
        }
      } else {
        // TODO: find condition for off day
        // no Dodger game today
        // game.playing_now = "No.";
        // game.no_but = "But I'm sure they will play again soon.";
        // var playing_now = Mustache.render(playing_now_template_no, game);
        // $('#playing-now').html(playing_now);
      }
      // get inning state
      if (game.top_inning === "Y") {
        game.inning_state = "caret up icon";
      } else if (game.top_inning === "N") {
        game.inning_state = "caret down icon";
      }
    });
    // render moustache template for games
    var other_games = Mustache.render(other_games_template, grid.data.games);
    $('#other-games').html(other_games);
    });
  }
  // get stupid things to do
  function getStupidThing(day) {
    // day = 01;
    // console.log("day:", day);
    var stupid = [
      'Point at someone and shout "Your one of them!" Run and pretend to trip. Crawl away slowly.',
      'Run up to someone random on the street and slap them with a loaf of bread.',
      'Look at see through glass and when someone is on the other side shout "OH MY GOD, I\'M HIDEOUS!"',
      'Go to McDonalds and ask for a happy meal with extra happy.',
      'Walk up to a small child that resembles you, and tell them that you are them from the future.',
      'Bring a desk on an elevator. When people try to get on ask if they have an appointment.',
      'Put a dora doll in the middle of Walmart.When someone tries to pick it up yell "SWIPER NO SWIPING".',
      'Go up to a random lady with a daughter and say her son is adorable.',
      'Go to a libary and ask for a book on how to read.',
      'Come late to school and when the teacher asks why say your pet rock had a seizure.',
      'and see what happens.',
      'Blow up a balloon, then ask someone to pop it, when they do, start screaming.',
      'Fill your mouth with whipped cream, then run down the street screaming "I HAVE RABIES".',
      'If skinny people skinny dip what do fat people do? Chunky Dunk?',
      'Go to petsmart and buy bird seed. Then ask the clerk how long it will take the birds to grow.',
      'Go to walmart, find a random old guy and yell, "GRANDPA! YOUR STILL ALIVE! ITS A MIRACLE".',
      'Shout "For Narnia!" and charge into a store, knocking over everything in your way.',
      'Throw a watermelon in front of someone. Then get on your knees, grab your hair and scream "NOOO!"',
      'Throw a small plastic ball at some body and then yell "get in your ball you stupid pokemon.',
      'Sit on a curb with a stuffed animal and scream at it about how it ruined your life.',
      'Run through a police station and yell " I finally escaped from prison!" .',
      'Go to a Chinese restaruant and ask for Mexican food.',
      'Buy an ice cream, ask the cashier if they believe in unicorns then squish the cone on your forehead.',
      'Buy an ice cream cone, stick it on top of someone\'s head and yell "Why did you steal my ice cream?"',
      'Dress up like a grandma and break dance in walmart.',
      'Go to weigth wachers with a bag of cookies.',
      'Tie hotwheels cars to the bottom of your cat/dog\'s feet.',
      'Go up to random people at the mall, show them your ID, and say, "HAVE YOU SEEN THIS MAN?!"',
      'Name your hair George, then go to the salon and be upstet that they killed him.',
      'Call someone to tell them you can\'t talk right now.',
      'Go to to a fast food restraunt and ask for a krabby patty, i they say no throw a fit.',
      'Glue yourself to the ceiling and when someone walks by spit on them.',
      'Run up to someone in Walmart and say U AINT GOT NO PANCAKE MIX!',
      'Tell your dad in a public place- "Look, old man, I don\'t want your candy!"',
      'In a public place, hold up a box of cheerios and yell "FREE DONUT SEEDS!".',
      'Make "No Dumping - Violators Will Be Prosecuted" signs and put them in public bathroom stalls.',
      'Dress up as ronald mcdonald and go to burger king.',
      'Sit in a cardboard box and yell at people who walk by that they\'re trespassing!',
      'When The Money Comes Out The ATM, Scream "I Won!, I Won!" "I Won!, I Won!"',
      'Go to an Italian restaurant dressed up as Mario. See what happens.',
      'Call a chicken place and ask how big there breast are.',
      'Go to mc. donalds and ask for fries without the potatos.',
      'Sing to public plants if anyone asks what you\'re doing scream and run.',
      'Go to a clothes store, go in the front window and pretend to be a manikin.',
      'Sniff a random person then stare at them for a while then say "your one of them".',
      'Go to a cloths store, walk into the dressing room. Walk out and ask where the toilet paper is!',
      'Tie a rock to a string and take it for a walk. Every now and then yell "Bad boy, Fluffy!"',
      'Go to a airport and say Can I go in your suitcase to every person you see.',
      'Go up to a really buff man and hug him yelling GRANDMAMA!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!',
      'Go in an elevator and then make peek-a-boo sounds when the doors open and close.',
      'Put a computer mouse in a mouse trap.',
      'Go to a pet shop, buy birdseed, and ask how long it will take to grow.',
      'Follow strangers around a store and spray everything they touch with disinfectant.',
      'Go to kfc and ask the way to mcdonalds.',
      'KLFHJNEAJHVHJSAFVJHLASGKJDZFFJE...sorry there was just a spider on the keyboard.',
      'Call a random phone number and yell, "Where is my fried chicken dude?!"',
      'Tape your nose up like a pig, and protest bacon at the grocery store.',
      'Find a midget on a street ask him to go up to people and say can i hav $20 I\'m a bit short.',
      'Walk around the mall five times talking to a carrot and see how many people look at you funny.',
      'Go to your teacher and say i know what you did last night.',
      'Dress up as ronald mcdonald and go aplpy for a job at burger king.',
      'Stand on the side of the road with a hair dryer and point it at cars.',
      'Go to the cinema and shout "HE\'S THE MURDERER!" whenever someone new comes on screen.',
      'Walk up to somebody and say "Im not wearing any pants" People will look down 99% of the time.',
      'Go to mcdonalds and ask for directions to KFC.',
      'In Wal-mart: Make a trail of orange juice on the ground, leading to the restrooms.',
      'See if you can get a Wal-Mart clerk to sell you just one M&M.',
      'Ring a random doorbell and when they answer just stare at them.',
      'Make an old lady help you across the street.',
      'Go to a clothing store, hide in a rack, and when people are browsing through, yell, "PICK ME!!!',
      'Go to Wal-Mart, buy a cucumber and some KY jelly. Notice the look on the cashier\'s face.',
      'Go to the store. Start Rolling around on the floor. Scream "Clean up on Aisle 3!"',
      'Throw glue sticks at random people walking down the street and see if it sticks to them!',
      'Ask a librarian if they have a book on learning to read.',
      'Open a window and yell ITS MY MONEY AND I NEED IT NOW!',
      'Ask the manager of a McDonalds where the nearest Burger King is.',
      'Dress up as a superhero pretending to stop bank robbers.',
      'Go to walmart, go to a dressing room, wait a few minutes and yell there is no toilet paper in here!',
      'Spit at a llama...How does it feel NOW you Darn LLAMA!',
      'Hire a taxi. When the man asks you where you want to go, say "To infinity, and beyond".',
      'Enter an elevator with people and sing and dance to "Peanut Butter Jelly Time."',
      'Ask pizza hut to deliver water.',
      'Go around the city park licking trees and if anyone asks say youre marking your territory.',
      'Go into a public bathroom and start singing "Taking Care of Business" very loudly.',
      'Hide in a public bathroom stall and when someone walks in, say "Ah young one, Welcome to Narnia."".',
      'Throw a pokemon ball at your teachers head and scream "gotta catch em all".',
      'Go in to a public bathroom, go into a stall, wait a second, then scream, "Mommy I need help!',
      'Go to a store, and leave a trail of orange juice leading to the bathrooms.',
      'Wear blue lipstick and tell every one who asks why, that you ate a smurf.',
      'Dress up as harry potter and stalk someone all day shouting random spells at them.',
      'Go to mcdonalds and ask for directions to burgerking.',
      'Put a lamp shade on your head and run around walmart.',
      'Attack you neighbors with an army of garden knomes!',
      'Convince a fat guy to give you 10,000$ for a giant cheese burger.',
      'When in an elevator with only one other person,stare at them and breathe heavily.',
      'Go to an atm machine and when the money comes out scream i win i win.',
      'Go into a grocery store and scream at cheese.',
      'Hide in a clothing rack in Walmart and when somebody goes by YELL "PICK ME PICK ME".',
      'Walk around with a blow dryer and ask people if they want a blow job.',
      'Go to McDonalds and order a diet water, drink it, do a spit take, and yell, I SAID DIET!'
    ];
    // TODO: pick a random stupid thing, but based on day
    // var stupid_random = Math.floor(Math.random()*stupid.length);
    // console.log("stupid_random:", stupid[stupid_random]);
    // return stupid[stupid_random];
    // return stupid thing based on what day it is
    return stupid[day];
  }

  // TODO: WIP outs for main game
  // function formatOuts(outs) {
  //   if ()
  // }

</script>
<style>
  .last.container {
    margin-bottom: 300px !important;
  }
  h1.ui.center.header {
    margin-top: 2em;
  }
  h2.ui.center.header {
    margin: 1em 0em 2em;
  }
  h3.ui.center.header {
    margin-top: 2em;
    padding: 2em 0em;
  }
  /* doubling to quartering hack */
  @media only screen and (max-width: 991px) and (min-width: 768px)
  .ui.four.doubling.cards .card {
    width: calc(25% - 2em);
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.10/clipboard.min.js"></script>
<script type="text/javascript">
  new Clipboard('.btn-share-url-copy');
</script>

</body>
</html>